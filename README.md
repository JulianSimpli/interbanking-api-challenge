# Interbanking API 

Sistema de gestiÃ³n de empresas y transferencias que implementa arquitectura hexagonal (Clean Architecture) con NestJS, proporcionando endpoints REST y una simple funcionalidad serverless con AWS Lambda.

## ğŸ—ï¸ Arquitectura y Patrones

### Arquitectura Hexagonal (Clean Architecture)
- **Domain Layer**: Entidades, value objects y servicios de dominio
- **Application Layer**: Casos de uso y servicios de aplicaciÃ³n
- **Infrastructure Layer**: Controladores, repositorios y adaptadores externos
- **Shared Layer**: Tipos y utilidades compartidas entre mÃ³dulos

## ğŸ“ Estructura del Proyecto

```
src/
â”œâ”€â”€ company/                 # MÃ³dulo de empresas
â”‚   â”œâ”€â”€ domain/             # Entidades, value objects y lÃ³gica de negocio
â”‚   â”‚   â”œâ”€â”€ entities/       # Company entity
â”‚   â”‚   â”œâ”€â”€ value-objects/  # CompanyId, Cuit, CompanyName
â”‚   â”‚   â”œâ”€â”€ services/       # CompanyDomainService
â”‚   â”‚   â””â”€â”€ repositories/   # CompanyRepository interface
â”‚   â”œâ”€â”€ application/        # Casos de uso y servicios
â”‚   â”‚   â””â”€â”€ services/       # CompanyApplicationService
â”‚   â””â”€â”€ infrastructure/     # Controladores, repositorios y adaptadores
â”‚       â”œâ”€â”€ controllers/    # CompanyController
â”‚       â”œâ”€â”€ repositories/   # SqliteCompanyRepository
â”‚       â”œâ”€â”€ mappers/        # CompanyMapper
â”‚       â”œâ”€â”€ dto/           # DTOs de entrada y salida
â”‚       â””â”€â”€ lambda/        # AWS Lambda handlers
â”œâ”€â”€ transfer/               # MÃ³dulo de transferencias
â”‚   â”œâ”€â”€ domain/            # Entidades, value objects y lÃ³gica de negocio
â”‚   â”‚   â”œâ”€â”€ entities/      # Transfer entity
â”‚   â”‚   â”œâ”€â”€ value-objects/ # TransferId, Amount, AccountNumber
â”‚   â”‚   â”œâ”€â”€ services/      # TransferDomainService
â”‚   â”‚   â””â”€â”€ repositories/  # TransferRepository interface
â”‚   â”œâ”€â”€ application/       # Casos de uso y servicios
â”‚   â”‚   â””â”€â”€ services/      # TransferApplicationService
â”‚   â””â”€â”€ infrastructure/    # Controladores, repositorios y adaptadores
â”‚       â”œâ”€â”€ controllers/   # TransferController
â”‚       â”œâ”€â”€ repositories/  # SqliteTransferRepository
â”‚       â”œâ”€â”€ mappers/       # TransferMapper
â”‚       â””â”€â”€ dto/          # DTOs de entrada y salida
â”œâ”€â”€ shared/                # Tipos y utilidades compartidas
â”‚   â”œâ”€â”€ types/            # Enums y tipos compartidos
â”‚   â”œâ”€â”€ utils/            # Utilidades de fecha y configuraciÃ³n
â”‚   â””â”€â”€ decorators/       # Decoradores personalizados
â”œâ”€â”€ config/               # ConfiguraciÃ³n de base de datos y entorno
â”œâ”€â”€ database/             # Scripts de base de datos y seeding
â””â”€â”€ main.ts               # Punto de entrada
```

## ğŸ“Š Entidades Principales

### Company
- **ID**: Identificador Ãºnico 
- **CUIT**: NÃºmero de identificaciÃ³n fiscal 
- **Name**: Nombre de la empresa 
- **AdhesionDate**: Fecha de adhesiÃ³n
- **Type**: Tipo (PYME/CORPORATE)

### Transfer
- **ID**: Identificador Ãºnico
- **Amount**: Monto de la transferencia
- **CompanyId**: ID de la empresa
- **DebitAccount**: Cuenta de dÃ©bito
- **CreditAccount**: Cuenta de crÃ©dito
- **CreatedAt**: Fecha de creaciÃ³n

## ğŸš€ ConfiguraciÃ³n

### Prerrequisitos
- Node.js 18+
- npm o yarn

### InstalaciÃ³n
```bash
# Clonar repositorio
git clone <repository-url>
cd interbanking-api

# Instalar dependencias
npm install

# Configurar variables de entorno
cp env.example .env
```

### Variables de Entorno
```env
PORT=3000
CORS_ORIGINS=http://localhost:3000,http://localhost:3001
```

### Base de Datos y Datos de Prueba
- **Base de datos**: SQLite persistente con TypeORM
- **Seeds**: Datos de prueba se cargan manualmente con `npm run db:seed`
- **Persistencia**: Los datos se mantienen entre reinicios del servidor
- **Synchronize**: Las tablas se crean automÃ¡ticamente al iniciar la aplicaciÃ³n
- **OptimizaciÃ³n**: Consultas optimizadas con JOINs para evitar filtrado en memoria

## ğŸ”§ Scripts Disponibles

```bash
# Desarrollo o ejecuciÃ³n local
npm run start:dev          # Servidor con hot reload
npm run start              # Servidor en modo desarrollo

# Build
npm run build              # Compilar TypeScript

# Testing
npm run test               # Ejecutar tests
npm run test:watch         # Tests en modo watch

# Database
npm run db:seed            # Cargar datos de prueba
```

## ğŸ”’ Seguridad

### Medidas Implementadas
- **Helmet**: Headers de seguridad HTTP
- **Rate Limiting**: LÃ­mite de 100 requests por IP cada 15 minutos
- **CORS**: ConfiguraciÃ³n restrictiva de orÃ­genes permitidos
- **Validation Pipe**: ValidaciÃ³n estricta de entrada con whitelist
- **Class Validator**: ValidaciÃ³n de DTOs con decoradores
- **Value Objects**: Validaciones de dominio en entidades

## ğŸ“š Swagger Autogenerated Documentation for test endpoints

### Acceso
- **URL**: `http://localhost:3000/api`
- **ConfiguraciÃ³n**: AutomÃ¡tica con `@nestjs/swagger`

### Endpoints Documentados

#### Companies
- `GET /companies` - Obtener todas las empresas
- `GET /companies/:id` - Obtener empresa por ID
- `POST /companies` - Crear nueva empresa
- `DELETE /companies/:id` - Eliminar empresa
- `GET /companies/transfers?period=last_month` - Empresas con transferencias en el Ãºltimo mes
- `GET /companies/adhesions?period=last_month` - Empresas adheridas en el Ãºltimo mes

#### Transfers
- `GET /transfers` - Obtener todas las transferencias
- `GET /transfers/:id` - Obtener transferencia por ID
- `POST /transfers` - Crear nueva transferencia
- `DELETE /transfers/:id` - Eliminar transferencia


## â˜ï¸ AWS Lambda - Company Adhesion

### Funcionalidad
Lambda function para procesar adhesiones de empresas, validar datos y almacenar en base de datos.

### IntegraciÃ³n con el Sistema
IntegrarÃ­a la Lambda como adaptador de entrada via API Gateway por ejemplo reutilizando las reglas de negocio implementadas. La Lambda importarÃ­a y utilizarÃ­a exactamente los mismos servicios de dominio y aplicaciÃ³n que usa la API REST. Con este enfoque tambiÃ©n se obtiene flexibilidad, ya que se puede cambiar la base de datos sin modificar la lÃ³gica (por ejemplo utilizar Dynamo para producciÃ³n). Y esto sumado a los beneficios de las implementaciones serverless (escalabilidad automÃ¡tica, pago por uso, alta disponibilidad, entre otros).

### Estructura de Archivos
```
src/company/infrastructure/lambda/
â”œâ”€â”€ company-adhesion.handler.ts    # Punto de entrada principal
â””â”€â”€ types.ts                       # Tipos AWS Lambda

src/shared/lambda/
â””â”€â”€ initialization.ts              # ConfiguraciÃ³n inicial de Lambda
```

#### DescripciÃ³n de Archivos

**`company-adhesion.handler.ts`**
- **PropÃ³sito**: Handler principal de la Lambda Function para adhesiÃ³n de empresas
- **Funciones**: 
  - Parsea eventos de API Gateway
  - Valida campos requeridos (cuit, name, adhesionDate, type)
  - Utiliza servicios de aplicaciÃ³n existentes para crear empresa
  - Retorna respuesta estructurada con success/error
- **IntegraciÃ³n**: Reutiliza CompanyApplicationService y lÃ³gica de dominio

**`types.ts`**
- **PropÃ³sito**: DefiniciÃ³n de tipos para AWS Lambda (APIGatewayProxyEvent, APIGatewayProxyResult)

**`initialization.ts`**
- **PropÃ³sito**: ConfiguraciÃ³n inicial de servicios para Lambda
- **Funciones**:
  - Inicializa conexiÃ³n a base de datos SQLite
  - Configura repositorios y servicios de aplicaciÃ³n
  - Optimiza reutilizaciÃ³n de conexiones en contenedor Lambda

### Input/Output
```json
// Input
{
  "cuit": "20-12345678-9",
  "name": "Empresa Ejemplo S.A.",
  "adhesionDate": "2024-01-15",
  "type": "PYME"
}

// Output
{
  "success": true,
  "message": "Company successfully adhered",
  "companyId": "generated-uuid-123"
}
```
